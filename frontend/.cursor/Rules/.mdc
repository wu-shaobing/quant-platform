---
description: 
globs: 
alwaysApply: false
---
# é‡åŒ–æŠ•èµ„å‰ç«¯å¹³å°å¼€å‘è§„èŒƒ - Cursor Rules

## ğŸ¯ é¡¹ç›®æ¦‚è¿°
è¿™æ˜¯ä¸€ä¸ªåŸºäº Vue 3 + TypeScript çš„é‡åŒ–æŠ•èµ„å‰ç«¯å¯è§†åŒ–å¹³å°ï¼Œæä¾›ç­–ç•¥ç›‘æ§ã€å›æµ‹åˆ†æã€å®æ—¶äº¤æ˜“çš„ä¸“ä¸šç•Œé¢ã€‚

## ğŸ“‹ æ ¸å¿ƒå¼€å‘åŸåˆ™

### 1. æ¶æ„éµä»åŸåˆ™
- ä¸¥æ ¼éµå¾ªåˆ†å±‚æ¶æ„ï¼šè¡¨ç°å±‚ â†’ ä¸šåŠ¡é€»è¾‘å±‚ â†’ æ•°æ®è®¿é—®å±‚ â†’ åŸºç¡€è®¾æ–½å±‚
- ç»„ä»¶èŒè´£å•ä¸€ï¼Œé«˜å†…èšã€ä½è€¦åˆ
- ä¸šåŠ¡é€»è¾‘ä¸UIé€»è¾‘åˆ†ç¦»ï¼Œä¼˜å…ˆä½¿ç”¨ç»„åˆå¼å‡½æ•°å°è£…

### 2. æŠ€æœ¯æ ˆè¦æ±‚
- **å‰ç«¯æ¡†æ¶**: Vue 3 (ç»„åˆå¼API) + TypeScript 5.0+
- **æ„å»ºå·¥å…·**: Vite 5.0+
- **UIç»„ä»¶åº“**: Element Plus 2.4+
- **å›¾è¡¨åº“**: ECharts 5.4+ (ä¸“ä¸šé‡‘èå›¾è¡¨)
- **çŠ¶æ€ç®¡ç†**: Pinia 2.1+
- **æ ·å¼**: Tailwind CSS 3.3+ + SCSS
- **è·¯ç”±**: Vue Router 4.2+

## ğŸ—ï¸ é¡¹ç›®ç»“æ„è§„èŒƒ

### ç›®å½•å‘½åè§„åˆ™
```
src/
â”œâ”€â”€ api/                    # APIæ¥å£å±‚ (kebab-case)
â”œâ”€â”€ assets/                 # é™æ€èµ„æº
â”œâ”€â”€ components/             # é€šç”¨ç»„ä»¶ (PascalCase)
â”œâ”€â”€ composables/            # ç»„åˆå¼å‡½æ•° (camelCase, useå‰ç¼€)
â”œâ”€â”€ layouts/                # å¸ƒå±€ç»„ä»¶ (PascalCase)
â”œâ”€â”€ router/                 # è·¯ç”±é…ç½®
â”œâ”€â”€ stores/                 # çŠ¶æ€ç®¡ç† (camelCase)
â”œâ”€â”€ types/                  # ç±»å‹å®šä¹‰ (camelCase)
â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•° (camelCase)
â”œâ”€â”€ views/                  # é¡µé¢è§†å›¾ (PascalCase + Viewåç¼€)
â””â”€â”€ workers/                # Web Workers
```

### ç»„ä»¶åˆ†å±‚è®¾è®¡
```
components/
â”œâ”€â”€ common/                 # é€šç”¨åŸºç¡€ç»„ä»¶
â”œâ”€â”€ charts/                 # å›¾è¡¨ç»„ä»¶ (é‡‘èä¸“ç”¨)
â”œâ”€â”€ trading/                # äº¤æ˜“åŠŸèƒ½ç»„ä»¶
â”œâ”€â”€ market/                 # è¡Œæƒ…åŠŸèƒ½ç»„ä»¶
â”œâ”€â”€ strategy/               # ç­–ç•¥åŠŸèƒ½ç»„ä»¶
â”œâ”€â”€ backtest/               # å›æµ‹åŠŸèƒ½ç»„ä»¶
â”œâ”€â”€ layout/                 # å¸ƒå±€ç»„ä»¶
â””â”€â”€ widgets/                # å°éƒ¨ä»¶ç»„ä»¶
```

## ğŸ’» ä»£ç ç¼–å†™è§„èŒƒ

### Vue ç»„ä»¶æ ‡å‡†ç»“æ„
```vue
<template>
  <!-- ä½¿ç”¨ kebab-case å‘½å -->
  <div class="component-name">
    <component-child 
      :prop-name="propValue"
      @event-name="handleEvent"
    />
  </div>
</template>

<script setup lang="ts">
// 1. å¯¼å…¥é¡ºåºï¼šVueç›¸å…³ â†’ ç¬¬ä¸‰æ–¹åº“ â†’ é¡¹ç›®å†…éƒ¨
import { ref, computed, onMounted } from 'vue'
import { ElMessage } from 'element-plus'
import { useComposable } from '@/composables/useComposable'

// 2. æ¥å£å®šä¹‰
interface Props {
  propName: string
  optionalProp?: number
}

interface Emits {
  (e: 'event-name', value: string): void
}

// 3. Props å’Œ Emits
const props = withDefaults(defineProps<Props>(), {
  optionalProp: 0
})

const emit = defineEmits<Emits>()

// 4. å“åº”å¼æ•°æ®
const loading = ref(false)
const data = ref<DataType[]>([])

// 5. è®¡ç®—å±æ€§
const computedValue = computed(() => {
  return props.propName.toUpperCase()
})

// 6. ç»„åˆå¼å‡½æ•°
const { method1, method2 } = useComposable()

// 7. æ–¹æ³•å®šä¹‰
const handleEvent = (value: string) => {
  emit('event-name', value)
}

// 8. ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  // åˆå§‹åŒ–é€»è¾‘
})
</script>

<style scoped>
.component-name {
  @apply flex flex-col bg-white rounded-lg shadow-financial;
}
</style>
```

### ç»„åˆå¼å‡½æ•°æ ‡å‡†ç»“æ„
```typescript
// src/composables/useExample.ts
import { ref, computed, onUnmounted } from 'vue'

export const useExample = (param?: string) => {
  // 1. å“åº”å¼çŠ¶æ€
  const loading = ref(false)
  const data = ref<DataType[]>([])
  const error = ref<string | null>(null)

  // 2. è®¡ç®—å±æ€§
  const processedData = computed(() => {
    return data.value.map(item => ({
      ...item,
      processed: true
    }))
  })

  // 3. æ–¹æ³•å®šä¹‰
  const fetchData = async () => {
    try {
      loading.value = true
      error.value = null
      // è·å–æ•°æ®é€»è¾‘
    } catch (err) {
      error.value = err instanceof Error ? err.message : 'æœªçŸ¥é”™è¯¯'
    } finally {
      loading.value = false
    }
  }

  const resetData = () => {
    data.value = []
    error.value = null
  }

  // 4. æ¸…ç†é€»è¾‘
  onUnmounted(() => {
    // æ¸…ç†èµ„æº
  })

  // 5. è¿”å›æ¥å£
  return {
    // çŠ¶æ€
    loading: readonly(loading),
    data: readonly(data),
    error: readonly(error),
    
    // è®¡ç®—å±æ€§
    processedData,
    
    // æ–¹æ³•
    fetchData,
    resetData
  }
}
```

### Pinia Store æ ‡å‡†ç»“æ„
```typescript
// src/stores/modules/example.ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'

export const useExampleStore = defineStore('example', () => {
  // 1. çŠ¶æ€å®šä¹‰
  const items = ref<ItemType[]>([])
  const loading = ref(false)
  const error = ref<string | null>(null)

  // 2. è®¡ç®—å±æ€§ (Getters)
  const itemCount = computed(() => items.value.length)
  const hasItems = computed(() => itemCount.value > 0)

  // 3. æ“ä½œæ–¹æ³• (Actions)
  const fetchItems = async () => {
    try {
      loading.value = true
      error.value = null
      // API è°ƒç”¨
    } catch (err) {
      error.value = err instanceof Error ? err.message : 'è·å–æ•°æ®å¤±è´¥'
    } finally {
      loading.value = false
    }
  }

  const addItem = (item: ItemType) => {
    items.value.push(item)
  }

  const removeItem = (id: string) => {
    const index = items.value.findIndex(item => item.id === id)
    if (index > -1) {
      items.value.splice(index, 1)
    }
  }

  const clearItems = () => {
    items.value = []
    error.value = null
  }

  // 4. è¿”å›æ¥å£
  return {
    // çŠ¶æ€
    items,
    loading,
    error,
    
    // è®¡ç®—å±æ€§
    itemCount,
    hasItems,
    
    // æ“ä½œ
    fetchItems,
    addItem,
    removeItem,
    clearItems
  }
})
```

## ğŸ“Š é‡‘èä¸šåŠ¡è§„èŒƒ

### 1. æ•°æ®æ ¼å¼åŒ–
```typescript
// ä»·æ ¼æ ¼å¼åŒ– - ä¿ç•™2ä½å°æ•°
const formatPrice = (price: number): string => {
  return price.toFixed(2)
}

// è´§å¸æ ¼å¼åŒ– - æ·»åŠ åƒåˆ†ä½åˆ†éš”ç¬¦
const formatCurrency = (amount: number): string => {
  return new Intl.NumberFormat('zh-CN', {
    style: 'currency',
    currency: 'CNY'
  }).format(amount)
}

// ç™¾åˆ†æ¯”æ ¼å¼åŒ–
const formatPercent = (value: number): string => {
  return `${(value * 100).toFixed(2)}%`
}

// æ¶¨è·Œå¹…é¢œè‰²ç±»
const getPriceChangeClass = (change: number) => {
  if (change > 0) return 'text-financial-up'
  if (change < 0) return 'text-financial-down'
  return 'text-financial-neutral'
}
```

### 2. äº¤æ˜“éªŒè¯è§„åˆ™
```typescript
// äº¤æ˜“æ•°é‡éªŒè¯ - å¿…é¡»æ˜¯100çš„å€æ•°
const validateQuantity = (quantity: number): boolean => {
  return quantity > 0 && quantity % 100 === 0
}

// ä»·æ ¼éªŒè¯ - æ¶¨è·Œåœé™åˆ¶
const validatePrice = (price: number, lastPrice: number): boolean => {
  const limitUp = lastPrice * 1.1
  const limitDown = lastPrice * 0.9
  return price >= limitDown && price <= limitUp
}

// èµ„é‡‘éªŒè¯
const validateFunds = (amount: number, availableFunds: number): boolean => {
  return amount <= availableFunds
}
```

### 3. å®æ—¶æ•°æ®å¤„ç†
```typescript
// WebSocket æ•°æ®æ›´æ–°
const handleQuoteUpdate = (data: QuoteData) => {
  // 1. æ•°æ®éªŒè¯
  if (!data.symbol || !data.price) return
  
  // 2. ä»·æ ¼é—ªçƒæ•ˆæœ
  triggerPriceFlash(data.symbol, data.change > 0 ? 'up' : 'down')
  
  // 3. æ›´æ–°å­˜å‚¨
  marketStore.updateQuote(data.symbol, data)
  
  // 4. è§¦å‘ç›¸å…³è®¡ç®—
  updatePortfolioValue()
}
```

## ğŸ¨ UI/UX è®¾è®¡è§„èŒƒ

### 1. é¢œè‰²ä½¿ç”¨
```scss
// é‡‘èä¸“ç”¨è‰²å½©
.price-up { color: theme('colors.financial.up'); }      // ä¸Šæ¶¨çº¢è‰²
.price-down { color: theme('colors.financial.down'); }  // ä¸‹è·Œç»¿è‰²
.price-neutral { color: theme('colors.financial.neutral'); } // å¹³ç›˜ç°è‰²

// èƒŒæ™¯è‰²
.bg-trading { background: theme('colors.financial.bg-primary'); }
.bg-secondary { background: theme('colors.financial.bg-secondary'); }
```

### 2. å“åº”å¼è®¾è®¡
```vue
<template>
  <!-- æ¡Œé¢ç«¯å¸ƒå±€ -->
  <div class="hidden lg:flex">
    <desktop-layout />
  </div>
  
  <!-- ç§»åŠ¨ç«¯å¸ƒå±€ -->
  <div class="lg:hidden">
    <mobile-layout />
  </div>
</template>
```

### 3. åŠ è½½çŠ¶æ€
```vue
<template>
  <div v-loading="loading" element-loading-text="åŠ è½½ä¸­...">
    <div v-if="error" class="error-state">
      <el-alert :title="error" type="error" />
    </div>
    <div v-else-if="!data.length" class="empty-state">
      <el-empty description="æš‚æ— æ•°æ®" />
    </div>
    <div v-else>
      <!-- æ•°æ®å±•ç¤º -->
    </div>
  </div>
</template>
```

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–è§„èŒƒ

### 1. å›¾è¡¨æ€§èƒ½
```typescript
// ä½¿ç”¨ Canvas æ¸²æŸ“å¤§æ•°æ®é‡å›¾è¡¨
const chartOption = {
  renderer: 'canvas',
  useDirtyRect: true,
  animation: false // å…³é—­åŠ¨ç”»æå‡æ€§èƒ½
}

// æ•°æ®åˆ†ç‰‡æ¸²æŸ“
const renderChartData = (data: KLineData[]) => {
  const chunkSize = 1000
  const chunks = chunk(data, chunkSize)
  
  chunks.forEach((chunk, index) => {
    setTimeout(() => {
      updateChartSeries(chunk, index)
    }, index * 16) // 16ms é—´éš”
  })
}
```

### 2. è™šæ‹Ÿæ»šåŠ¨
```vue
<template>
  <virtual-list
    :data="largeDataSet"
    :item-height="40"
    :container-height="400"
    :buffer-size="5"
  >
    <template #item="{ item }">
      <stock-item :data="item" />
    </template>
  </virtual-list>
</template>
```

### 3. é˜²æŠ–èŠ‚æµ
```typescript
// æœç´¢é˜²æŠ–
const debouncedSearch = debounce(async (keyword: string) => {
  await searchStocks(keyword)
}, 300)

// æ»šåŠ¨èŠ‚æµ
const throttledScroll = throttle((event: Event) => {
  handleScroll(event)
}, 16)
```

## ğŸ”’ å®‰å…¨è§„èŒƒ

### 1. XSS é˜²æŠ¤
```typescript
import DOMPurify from 'dompurify'

// æ¸…ç†ç”¨æˆ·è¾“å…¥
const sanitizeInput = (input: string): string => {
  return DOMPurify.sanitize(input)
}

// å®‰å…¨æ¸²æŸ“ HTML
const safeHtml = (html: string): string => {
  return DOMPurify.sanitize(html, {
    ALLOWED_TAGS: ['b', 'i', 'em', 'strong'],
    ALLOWED_ATTR: []
  })
}
```

### 2. Token ç®¡ç†
```typescript
// Token è‡ªåŠ¨åˆ·æ–°
const refreshTokenIfNeeded = async () => {
  const token = getAccessToken()
  if (token && shouldRefreshToken(token)) {
    await refreshToken()
  }
}
```

## ğŸ§ª æµ‹è¯•è§„èŒƒ

### 1. ç»„ä»¶æµ‹è¯•
```typescript
// æµ‹è¯•æ–‡ä»¶å‘½å: ComponentName.spec.ts
describe('KLineChart', () => {
  it('should render chart with data', () => {
    const wrapper = mount(KLineChart, {
      props: { symbol: '000001.SZ' }
    })
    expect(wrapper.find('.chart-container').exists()).toBe(true)
  })
})
```

### 2. ç»„åˆå¼å‡½æ•°æµ‹è¯•
```typescript
describe('useMarketData', () => {
  it('should fetch market data', async () => {
    const { fetchData, data, loading } = useMarketData()
    
    expect(loading.value).toBe(false)
    await fetchData('000001.SZ')
    expect(data.value).toBeDefined()
  })
})
```

## âŒ ç¦æ­¢äº‹é¡¹

### 1. ä»£ç è´¨é‡
- âŒ ä¸å…è®¸ä½¿ç”¨ `any` ç±»å‹ï¼Œå¿…é¡»æ˜ç¡®ç±»å‹å®šä¹‰
- âŒ ä¸å…è®¸åœ¨ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨ APIï¼Œå¿…é¡»é€šè¿‡ composables
- âŒ ä¸å…è®¸åœ¨ template ä¸­å†™å¤æ‚é€»è¾‘ï¼Œåº”æå–åˆ° computed
- âŒ ä¸å…è®¸ä½¿ç”¨ Options APIï¼Œç»Ÿä¸€ä½¿ç”¨ Composition API

### 2. æ€§èƒ½ç›¸å…³
- âŒ ä¸å…è®¸åœ¨ v-for ä¸­ä½¿ç”¨ index ä½œä¸º key
- âŒ ä¸å…è®¸åœ¨ç»„ä»¶ä¸­ç›´æ¥æ“ä½œ DOMï¼Œä½¿ç”¨ ref æˆ–æŒ‡ä»¤
- âŒ ä¸å…è®¸åœ¨ watch ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œè€Œä¸åšé˜²æŠ–å¤„ç†

### 3. å®‰å…¨ç›¸å…³
- âŒ ä¸å…è®¸ç›´æ¥æ¸²æŸ“ç”¨æˆ·è¾“å…¥çš„ HTML
- âŒ ä¸å…è®¸åœ¨ localStorage ä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- âŒ ä¸å…è®¸åœ¨å‰ç«¯ç¡¬ç¼–ç  API å¯†é’¥

### 4. ä¸šåŠ¡ç›¸å…³
- âŒ ä¸å…è®¸åœ¨å‰ç«¯è¿›è¡Œé‡‘èè®¡ç®—çš„æœ€ç»ˆç¡®è®¤
- âŒ ä¸å…è®¸ç»•è¿‡åç«¯éªŒè¯ç›´æ¥æäº¤äº¤æ˜“
- âŒ ä¸å…è®¸åœ¨å®¢æˆ·ç«¯ç¼“å­˜æ•æ„Ÿçš„äº¤æ˜“æ•°æ®

## âœ… æœ€ä½³å®è·µ

### 1. ç»„ä»¶è®¾è®¡
```vue
<!-- âœ… å¥½çš„ç»„ä»¶è®¾è®¡ -->
<template>
  <div class="stock-card">
    <stock-header :stock="stock" />
    <stock-price :price="stock.price" :change="stock.change" />
    <slot name="actions" :stock="stock" />
  </div>
</template>

<script setup lang="ts">
interface Props {
  stock: StockInfo
  readonly?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  readonly: false
})

// å•ä¸€èŒè´£ï¼šåªå¤„ç†æ˜¾ç¤ºé€»è¾‘
const priceClass = computed(() => ({
  'text-financial-up': props.stock.change > 0,
  'text-financial-down': props.stock.change < 0
}))
</script>
```

### 2. é”™è¯¯å¤„ç†
```typescript
// âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†
const handleApiError = (error: unknown) => {
  if (error instanceof Error) {
    ElMessage.error(error.message)
  } else {
    ElMessage.error('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•')
  }
  
  // ä¸ŠæŠ¥é”™è¯¯
  errorReporting.captureException(error)
}
```

### 3. ç±»å‹å®šä¹‰
```typescript
// âœ… å®Œæ•´çš„ç±»å‹å®šä¹‰
interface StockInfo {
  symbol: string
  name: string
  currentPrice: number
  change: number
  changePercent: number
  volume: number
  marketCap: number
  pe?: number
  pb?: number
}

interface ApiResponse<T> {
  code: number
  message: string
  data: T
  timestamp: number
}
```

## ğŸ“ ä»£ç å®¡æŸ¥æ¸…å•

### æäº¤å‰æ£€æŸ¥
- [ ] ä»£ç æ˜¯å¦éµå¾ª TypeScript ä¸¥æ ¼æ¨¡å¼
- [ ] ç»„ä»¶æ˜¯å¦æœ‰é€‚å½“çš„ Props ç±»å‹å®šä¹‰
- [ ] æ˜¯å¦æœ‰æœªå¤„ç†çš„ Promise é”™è¯¯
- [ ] æ˜¯å¦æœ‰å†…å­˜æ³„æ¼é£é™©ï¼ˆäº‹ä»¶ç›‘å¬å™¨ã€å®šæ—¶å™¨ç­‰ï¼‰
- [ ] æ˜¯å¦éµå¾ªå“åº”å¼è®¾è®¡åŸåˆ™
- [ ] æ˜¯å¦æœ‰é€‚å½“çš„åŠ è½½å’Œé”™è¯¯çŠ¶æ€
- [ ] é‡‘èæ•°æ®æ ¼å¼åŒ–æ˜¯å¦æ­£ç¡®
- [ ] æ˜¯å¦æœ‰å®‰å…¨é£é™©ï¼ˆXSSã€æ•°æ®æ³„éœ²ç­‰ï¼‰

### æ€§èƒ½æ£€æŸ¥
- [ ] å¤§åˆ—è¡¨æ˜¯å¦ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
- [ ] å›¾è¡¨æ˜¯å¦é’ˆå¯¹å¤§æ•°æ®é‡ä¼˜åŒ–
- [ ] æ˜¯å¦æœ‰ä¸å¿…è¦çš„é‡å¤æ¸²æŸ“
- [ ] WebSocket è¿æ¥æ˜¯å¦æ­£ç¡®ç®¡ç†
- [ ] æ˜¯å¦æœ‰å†…å­˜æ³„æ¼

### ä¸šåŠ¡é€»è¾‘æ£€æŸ¥
- [ ] äº¤æ˜“éªŒè¯é€»è¾‘æ˜¯å¦å®Œæ•´
- [ ] ä»·æ ¼è®¡ç®—æ˜¯å¦ç²¾ç¡®
- [ ] é£é™©æ§åˆ¶æ˜¯å¦åˆ°ä½
- [ ] ç”¨æˆ·æƒé™æ˜¯å¦æ­£ç¡®éªŒè¯

---
## ğŸ¯ å¼€å‘ç›®æ ‡

éµå¾ªä»¥ä¸Šè§„èŒƒï¼Œæ„å»ºä¸€ä¸ªï¼š
- **é«˜æ€§èƒ½**: æ¯«ç§’çº§å“åº”ï¼Œæµç•…çš„ç”¨æˆ·ä½“éªŒ
- **é«˜å¯é **: ç¨³å®šçš„å®æ—¶æ•°æ®å¤„ç†ï¼Œå‡†ç¡®çš„é‡‘èè®¡ç®—
- **é«˜å®‰å…¨**: å®Œå–„çš„å®‰å…¨é˜²æŠ¤ï¼Œä¿æŠ¤ç”¨æˆ·èµ„äº§å®‰å…¨
- **é«˜å¯ç»´æŠ¤**: æ¸…æ™°çš„ä»£ç ç»“æ„ï¼Œå®Œå–„çš„ç±»å‹å®šä¹‰
- **é«˜æ‰©å±•**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºåŠŸèƒ½æ‰©å±•

è®°ä½ï¼šæˆ‘ä»¬åœ¨æ„å»ºçš„ä¸ä»…æ˜¯ä¸€ä¸ªå‰ç«¯åº”ç”¨ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸“ä¸šçš„é‡‘èäº¤æ˜“å¹³å°ï¼Œæ¯ä¸€è¡Œä»£ç éƒ½å…³ä¹ç”¨æˆ·çš„èµ„äº§å®‰å…¨ã€‚
