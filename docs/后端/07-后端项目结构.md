# åç«¯é¡¹ç›®ç»“æ„è¯¦ç»†è¯´æ˜

## ğŸ“ å®Œæ•´ç›®å½•ç»“æ„

```
quant-backend/
â”œâ”€â”€ .github/                          # GitHubé…ç½®
â”‚   â”œâ”€â”€ workflows/                   # CI/CDå·¥ä½œæµ
â”‚   â”‚   â”œâ”€â”€ test.yml                # æµ‹è¯•æµç¨‹
â”‚   â”‚   â”œâ”€â”€ build.yml               # æ„å»ºæµç¨‹
â”‚   â”‚   â””â”€â”€ deploy.yml              # éƒ¨ç½²æµç¨‹
â”‚   â”œâ”€â”€ ISSUE_TEMPLATE/             # Issueæ¨¡æ¿
â”‚   â””â”€â”€ PULL_REQUEST_TEMPLATE.md    # PRæ¨¡æ¿
â”œâ”€â”€ .vscode/                         # VSCodeé…ç½®
â”‚   â”œâ”€â”€ settings.json               # ç¼–è¾‘å™¨è®¾ç½®
â”‚   â”œâ”€â”€ launch.json                 # è°ƒè¯•é…ç½®
â”‚   â””â”€â”€ extensions.json             # æ¨èæ‰©å±•
â”œâ”€â”€ docs/                           # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ api/                        # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ deployment/                 # éƒ¨ç½²æ–‡æ¡£
â”‚   â”œâ”€â”€ development/                # å¼€å‘æ–‡æ¡£
â”‚   â””â”€â”€ architecture/               # æ¶æ„æ–‡æ¡£
â”œâ”€â”€ scripts/                        # è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ init_db.py                 # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”œâ”€â”€ data_importer.py           # æ•°æ®å¯¼å…¥å·¥å…·
â”‚   â”œâ”€â”€ ctp_connector.py           # CTPè¿æ¥æµ‹è¯•
â”‚   â”œâ”€â”€ backup.py                  # æ•°æ®å¤‡ä»½è„šæœ¬
â”‚   â””â”€â”€ deploy.sh                  # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ tests/                          # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py                # pytesté…ç½®
â”‚   â”œâ”€â”€ unit/                      # å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_services/         # æœåŠ¡å±‚æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_models/           # æ¨¡å‹æµ‹è¯•
â”‚   â”‚   â””â”€â”€ test_utils/            # å·¥å…·å‡½æ•°æµ‹è¯•
â”‚   â”œâ”€â”€ integration/               # é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_api/              # APIæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_database/         # æ•°æ®åº“æµ‹è¯•
â”‚   â”‚   â””â”€â”€ test_ctp/              # CTPæ¥å£æµ‹è¯•
â”‚   â””â”€â”€ fixtures/                  # æµ‹è¯•æ•°æ®
â”‚       â”œâ”€â”€ market_data.json       # è¡Œæƒ…æµ‹è¯•æ•°æ®
â”‚       â””â”€â”€ user_data.json         # ç”¨æˆ·æµ‹è¯•æ•°æ®
â”œâ”€â”€ app/                            # åº”ç”¨æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                    # FastAPIåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ api/                       # APIè·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ deps.py                # ä¾èµ–æ³¨å…¥
â”‚   â”‚   â”œâ”€â”€ v1/                    # API v1ç‰ˆæœ¬
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py            # è®¤è¯ç›¸å…³API
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py            # ç”¨æˆ·ç®¡ç†API
â”‚   â”‚   â”‚   â”œâ”€â”€ market.py          # è¡Œæƒ…æ•°æ®API
â”‚   â”‚   â”‚   â”œâ”€â”€ trading.py         # äº¤æ˜“ç›¸å…³API
â”‚   â”‚   â”‚   â”œâ”€â”€ strategy.py        # ç­–ç•¥ç®¡ç†API
â”‚   â”‚   â”‚   â”œâ”€â”€ backtest.py        # å›æµ‹åˆ†æAPI
â”‚   â”‚   â”‚   â”œâ”€â”€ portfolio.py       # æŠ•èµ„ç»„åˆAPI
â”‚   â”‚   â”‚   â”œâ”€â”€ risk.py            # é£é™©ç®¡ç†API
â”‚   â”‚   â”‚   â””â”€â”€ notification.py    # é€šçŸ¥ç›¸å…³API
â”‚   â”‚   â””â”€â”€ websocket/              # WebSocketæœåŠ¡
â”‚   â”‚       â”œâ”€â”€ __init__.py         # WebSocketæ¨¡å—åˆå§‹åŒ–
â”‚   â”‚       â”œâ”€â”€ connection.py       # åŸç”ŸWebSocketè¿æ¥ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ handlers.py         # WebSocketæ¶ˆæ¯å¤„ç†å™¨
â”‚   â”‚       â”œâ”€â”€ market_data.py      # è¡Œæƒ…æ•°æ®æ¨é€
â”‚   â”‚       â”œâ”€â”€ trading.py          # äº¤æ˜“æ•°æ®æ¨é€
â”‚   â”‚       â””â”€â”€ notifications.py    # ç³»ç»Ÿé€šçŸ¥æ¨é€
â”‚   â”œâ”€â”€ core/                      # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py              # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ security.py            # å®‰å…¨è®¤è¯
â”‚   â”‚   â”œâ”€â”€ scheduler.py           # ä»»åŠ¡è°ƒåº¦
â”‚   â”‚   â”œâ”€â”€ exceptions.py          # è‡ªå®šä¹‰å¼‚å¸¸
â”‚   â”‚   â”œâ”€â”€ middleware.py          # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ logging.py             # æ—¥å¿—é…ç½®
â”‚   â”‚   â””â”€â”€ ctp_wrapper.py         # CTPæ¥å£å°è£…
â”‚   â”œâ”€â”€ db/                        # æ•°æ®åº“å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                # æ•°æ®åº“åŸºç±»
â”‚   â”‚   â”œâ”€â”€ session.py             # ä¼šè¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ init_db.py             # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ models/                # ORMæ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py            # åŸºç¡€æ¨¡å‹ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py            # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ account.py         # è´¦æˆ·æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ position.py        # æŒä»“æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ order.py           # è®¢å•æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ trade.py           # æˆäº¤æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ strategy.py        # ç­–ç•¥æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ backtest.py        # å›æµ‹æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ market_data.py     # è¡Œæƒ…æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ notification.py    # é€šçŸ¥æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ crud/                  # CRUDæ“ä½œ
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py            # åŸºç¡€CRUDç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py            # ç”¨æˆ·CRUD
â”‚   â”‚   â”‚   â”œâ”€â”€ order.py           # è®¢å•CRUD
â”‚   â”‚   â”‚   â”œâ”€â”€ position.py        # æŒä»“CRUD
â”‚   â”‚   â”‚   â”œâ”€â”€ strategy.py        # ç­–ç•¥CRUD
â”‚   â”‚   â”‚   â””â”€â”€ market_data.py     # è¡Œæƒ…æ•°æ®CRUD
â”‚   â”‚   â””â”€â”€ migrations/            # æ•°æ®åº“è¿ç§»
â”‚   â”‚       â””â”€â”€ versions/          # è¿ç§»ç‰ˆæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ services/                  # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                # åŸºç¡€æœåŠ¡ç±»
â”‚   â”‚   â”œâ”€â”€ auth_service.py        # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ user_service.py        # ç”¨æˆ·æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ market_service.py      # è¡Œæƒ…æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ trading_service.py     # äº¤æ˜“æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ strategy_service.py    # ç­–ç•¥æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ backtest_service.py    # å›æµ‹æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ portfolio_service.py   # æŠ•èµ„ç»„åˆæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ risk_service.py        # é£é™©ç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ report_service.py      # æŠ¥å‘Šç”ŸæˆæœåŠ¡
â”‚   â”‚   â””â”€â”€ notification_service.py # é€šçŸ¥æœåŠ¡
â”‚   â”œâ”€â”€ schemas/                   # Pydanticæ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                # åŸºç¡€Schema
â”‚   â”‚   â”œâ”€â”€ user.py                # ç”¨æˆ·Schema
â”‚   â”‚   â”œâ”€â”€ auth.py                # è®¤è¯Schema
â”‚   â”‚   â”œâ”€â”€ order.py               # è®¢å•Schema
â”‚   â”‚   â”œâ”€â”€ position.py            # æŒä»“Schema
â”‚   â”‚   â”œâ”€â”€ trade.py               # æˆäº¤Schema
â”‚   â”‚   â”œâ”€â”€ strategy.py            # ç­–ç•¥Schema
â”‚   â”‚   â”œâ”€â”€ backtest.py            # å›æµ‹Schema
â”‚   â”‚   â”œâ”€â”€ market.py              # è¡Œæƒ…Schema
â”‚   â”‚   â”œâ”€â”€ portfolio.py           # æŠ•èµ„ç»„åˆSchema
â”‚   â”‚   â”œâ”€â”€ risk.py                # é£é™©Schema
â”‚   â”‚   â””â”€â”€ notification.py        # é€šçŸ¥Schema
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ date_utils.py          # æ—¶é—´å¤„ç†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ data_utils.py          # æ•°æ®å¤„ç†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ chart_data_utils.py    # å›¾è¡¨æ•°æ®å¤„ç†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ calculation_utils.py   # è®¡ç®—å·¥å…·
â”‚   â”‚   â”œâ”€â”€ format_utils.py        # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚   â”œâ”€â”€ validation_utils.py    # éªŒè¯å·¥å…·
â”‚   â”‚   â”œâ”€â”€ encryption_utils.py    # åŠ å¯†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ cache_utils.py         # ç¼“å­˜å·¥å…·
â”‚   â”‚   â””â”€â”€ file_utils.py          # æ–‡ä»¶å¤„ç†å·¥å…·
â”‚   â”œâ”€â”€ tasks/                     # Celeryå¼‚æ­¥ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ celery_app.py          # Celeryåº”ç”¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ backtest_tasks.py      # å›æµ‹ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ data_tasks.py          # æ•°æ®å¤„ç†ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ report_tasks.py        # æŠ¥å‘Šç”Ÿæˆä»»åŠ¡
â”‚   â”‚   â””â”€â”€ notification_tasks.py  # é€šçŸ¥ä»»åŠ¡
â”‚   â”œâ”€â”€ events/                    # äº‹ä»¶å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ market_events.py       # è¡Œæƒ…äº‹ä»¶
â”‚   â”‚   â”œâ”€â”€ trading_events.py      # äº¤æ˜“äº‹ä»¶
â”‚   â”‚   â””â”€â”€ system_events.py       # ç³»ç»Ÿäº‹ä»¶
â”‚   â””â”€â”€ constants/                 # å¸¸é‡å®šä¹‰
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ trading.py             # äº¤æ˜“å¸¸é‡
â”‚       â”œâ”€â”€ market.py              # è¡Œæƒ…å¸¸é‡
â”‚       â””â”€â”€ system.py              # ç³»ç»Ÿå¸¸é‡
â”œâ”€â”€ data/                          # æ•°æ®å­˜å‚¨ç›®å½•
â”‚   â”œâ”€â”€ historical/                # å†å²æ•°æ®
â”‚   â”‚   â”œâ”€â”€ kline/                 # Kçº¿æ•°æ®
â”‚   â”‚   â”œâ”€â”€ tick/                  # Tickæ•°æ®
â”‚   â”‚   â””â”€â”€ fundamental/           # åŸºæœ¬é¢æ•°æ®
â”‚   â”œâ”€â”€ realtime/                  # å®æ—¶æ•°æ®ç¼“å­˜
â”‚   â”œâ”€â”€ reports/                   # ç”Ÿæˆçš„æŠ¥å‘Š
â”‚   â”‚   â”œâ”€â”€ backtest/              # å›æµ‹æŠ¥å‘Š
â”‚   â”‚   â””â”€â”€ performance/           # ç»©æ•ˆæŠ¥å‘Š
â”‚   â””â”€â”€ logs/                      # æ—¥å¿—æ–‡ä»¶
â”‚       â”œâ”€â”€ app.log                # åº”ç”¨æ—¥å¿—
â”‚       â”œâ”€â”€ trade.log              # äº¤æ˜“æ—¥å¿—
â”‚       â””â”€â”€ error.log              # é”™è¯¯æ—¥å¿—
â”œâ”€â”€ docker/                        # Dockeré…ç½®
â”‚   â”œâ”€â”€ Dockerfile                 # ä¸»åº”ç”¨é•œåƒ
â”‚   â”œâ”€â”€ Dockerfile.worker          # Workeré•œåƒ
â”‚   â”œâ”€â”€ docker-compose.yml         # å¼€å‘ç¯å¢ƒç¼–æ’
â”‚   â”œâ”€â”€ docker-compose.prod.yml    # ç”Ÿäº§ç¯å¢ƒç¼–æ’
â”‚   â””â”€â”€ nginx/                     # Nginxé…ç½®
â”‚       â”œâ”€â”€ nginx.conf             # Nginxä¸»é…ç½®
â”‚       â””â”€â”€ ssl/                   # SSLè¯ä¹¦
â”œâ”€â”€ k8s/                           # Kubernetesé…ç½®
â”‚   â”œâ”€â”€ namespace.yaml             # å‘½åç©ºé—´
â”‚   â”œâ”€â”€ configmap.yaml             # é…ç½®æ˜ å°„
â”‚   â”œâ”€â”€ secret.yaml                # å¯†é’¥é…ç½®
â”‚   â”œâ”€â”€ deployment.yaml            # éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ service.yaml               # æœåŠ¡é…ç½®
â”‚   â”œâ”€â”€ ingress.yaml               # å…¥å£é…ç½®
â”‚   â””â”€â”€ hpa.yaml                   # è‡ªåŠ¨æ‰©ç¼©å®¹
â”œâ”€â”€ monitoring/                    # ç›‘æ§é…ç½®
â”‚   â”œâ”€â”€ prometheus/                # Prometheusé…ç½®
â”‚   â”‚   â”œâ”€â”€ prometheus.yml         # ä¸»é…ç½®
â”‚   â”‚   â””â”€â”€ rules/                 # å‘Šè­¦è§„åˆ™
â”‚   â”œâ”€â”€ grafana/                   # Grafanaé…ç½®
â”‚   â”‚   â”œâ”€â”€ dashboards/            # ä»ªè¡¨ç›˜
â”‚   â”‚   â””â”€â”€ provisioning/          # è‡ªåŠ¨é…ç½®
â”‚   â””â”€â”€ alertmanager/              # å‘Šè­¦ç®¡ç†å™¨
â”‚       â””â”€â”€ alertmanager.yml       # å‘Šè­¦é…ç½®
â”œâ”€â”€ .env.example                   # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .env.development               # å¼€å‘ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.production                # ç”Ÿäº§ç¯å¢ƒå˜é‡
â”œâ”€â”€ .gitignore                     # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ .dockerignore                  # Dockerå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ requirements.txt               # Pythonä¾èµ–
â”œâ”€â”€ requirements-dev.txt           # å¼€å‘ä¾èµ–
â”œâ”€â”€ pyproject.toml                 # é¡¹ç›®é…ç½®
â”œâ”€â”€ alembic.ini                    # Alembicé…ç½®
â”œâ”€â”€ pytest.ini                    # pytesté…ç½®
â”œâ”€â”€ Makefile                       # Makeå‘½ä»¤
â”œâ”€â”€ README.md                      # é¡¹ç›®è¯´æ˜
â””â”€â”€ CHANGELOG.md                   # æ›´æ–°æ—¥å¿—
```

## ğŸ“¦ å…³é”®æ–‡ä»¶å†…å®¹ç¤ºä¾‹

### requirements.txt
```txt
# Webæ¡†æ¶
fastapi==0.104.1
uvicorn[standard]==0.24.0
pydantic==2.5.0
pydantic-settings==2.1.0

# æ•°æ®åº“
sqlalchemy==2.0.23
asyncpg==0.29.0
alembic==1.13.0
redis==5.0.1

# æ•°æ®å¤„ç†
pandas==2.1.4
numpy==1.25.2
ta-lib==0.4.26

# CTPæ¥å£
openctp==6.7.0.1

# ä»»åŠ¡é˜Ÿåˆ—
celery==5.3.4
kombu==5.3.4

# å®‰å…¨è®¤è¯
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6

# ç›‘æ§
prometheus-client==0.19.0
sentry-sdk==1.39.1

# å·¥å…·åº“
python-dateutil==2.8.2
pytz==2023.3

# WebSocket (åŸç”ŸWebSocketï¼Œç§»é™¤python-socketio)
websockets==12.0
```

### Dockerfile
```dockerfile
FROM python:3.11-slim

WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \\
    gcc \\
    g++ \\
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 8000

# å¯åŠ¨å‘½ä»¤
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### docker-compose.yml
```yaml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://postgres:password@db:5432/quant
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - db
      - redis
    volumes:
      - ./data:/app/data

  db:
    image: postgres:15
    environment:
      - POSTGRES_DB=quant
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  worker:
    build: .
    command: celery -A app.tasks.celery_app worker --loglevel=info
    environment:
      - DATABASE_URL=postgresql://postgres:password@db:5432/quant
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - db
      - redis
    volumes:
      - ./data:/app/data

volumes:
  postgres_data:
  redis_data:
```

## ğŸ“‚ ç›®å½•è¯´æ˜

### ğŸ—ï¸ æ¶æ„åˆ†å±‚

#### 1. APIå±‚ (app/api/)
- **è·¯ç”±å®šä¹‰**: RESTful APIç«¯ç‚¹å®šä¹‰
- **è¯·æ±‚å¤„ç†**: HTTPè¯·æ±‚å‚æ•°éªŒè¯ä¸å“åº”
- **ä¾èµ–æ³¨å…¥**: æœåŠ¡å±‚ä¾èµ–ç®¡ç†
- **WebSocket**: å®æ—¶é€šä¿¡å¤„ç†

#### 2. æœåŠ¡å±‚ (app/services/)
- **ä¸šåŠ¡é€»è¾‘**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å®ç°
- **å¤–éƒ¨æ¥å£**: ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
- **æ•°æ®å¤„ç†**: å¤æ‚æ•°æ®å¤„ç†ä¸è®¡ç®—
- **ç¼“å­˜ç®¡ç†**: Redisç¼“å­˜æ“ä½œ

#### 3. æ•°æ®å±‚ (app/db/)
- **ORMæ¨¡å‹**: SQLAlchemyæ•°æ®æ¨¡å‹
- **CRUDæ“ä½œ**: æ•°æ®åº“å¢åˆ æ”¹æŸ¥å°è£…
- **æ•°æ®è¿ç§»**: Alembicæ•°æ®åº“ç‰ˆæœ¬ç®¡ç†
- **ä¼šè¯ç®¡ç†**: æ•°æ®åº“è¿æ¥æ± ç®¡ç†

#### 4. å·¥å…·å±‚ (app/utils/)
- **é€šç”¨å·¥å…·**: å¯å¤ç”¨çš„å·¥å…·å‡½æ•°
- **æ•°æ®å¤„ç†**: NumPy/Pandasæ•°æ®æ“ä½œ
- **æ ¼å¼åŒ–**: æ•°æ®æ ¼å¼è½¬æ¢
- **éªŒè¯**: æ•°æ®éªŒè¯ä¸æ¸…æ´—

### ğŸ¯ æ¨¡å—åŠŸèƒ½è¯´æ˜

#### æ ¸å¿ƒæ¨¡å— (app/core/)
```python
# config.py - é…ç½®ç®¡ç†
class Settings(BaseSettings):
    app_name: str = "Quant Backend"
    database_url: str
    redis_url: str
    ctp_broker_id: str
    jwt_secret: str
    
    class Config:
        env_file = ".env"

# security.py - å®‰å…¨è®¤è¯
def create_access_token(data: dict) -> str:
    """åˆ›å»ºJWTè®¿é—®ä»¤ç‰Œ"""
    
def verify_token(token: str) -> dict:
    """éªŒè¯JWTä»¤ç‰Œ"""

# ctp_wrapper.py - CTPæ¥å£å°è£…
class CTPService:
    def __init__(self, config: CTPConfig):
        """åˆå§‹åŒ–CTPè¿æ¥"""
    
    async def place_order(self, order: OrderRequest) -> str:
        """ä¸‹å•æ¥å£"""
    
    async def cancel_order(self, order_id: str) -> bool:
        """æ’¤å•æ¥å£"""
```

#### æœåŠ¡æ¨¡å— (app/services/)
```python
# market_service.py - è¡Œæƒ…æœåŠ¡
class MarketService:
    async def get_realtime_quote(self, symbol: str) -> QuoteData:
        """è·å–å®æ—¶è¡Œæƒ…"""
    
    async def get_kline_data(self, symbol: str, period: str) -> List[KLineData]:
        """è·å–Kçº¿æ•°æ®"""
    
    async def subscribe_market_data(self, symbols: List[str]):
        """è®¢é˜…è¡Œæƒ…æ•°æ®"""

# trading_service.py - äº¤æ˜“æœåŠ¡
class TradingService:
    async def place_order(self, order: OrderRequest) -> OrderResponse:
        """æäº¤è®¢å•"""
    
    async def get_positions(self, user_id: str) -> List[Position]:
        """è·å–æŒä»“"""
    
    async def get_account_info(self, user_id: str) -> AccountInfo:
        """è·å–è´¦æˆ·ä¿¡æ¯"""

# backtest_service.py - å›æµ‹æœåŠ¡
class BacktestService:
    async def run_backtest(self, params: BacktestParams) -> BacktestResult:
        """è¿è¡Œå›æµ‹"""
    
    async def generate_report(self, result: BacktestResult) -> str:
        """ç”Ÿæˆå›æµ‹æŠ¥å‘Š"""
```

#### æ•°æ®æ¨¡å‹ (app/db/models/)
```python
# user.py - ç”¨æˆ·æ¨¡å‹
class User(Base):
    __tablename__ = "users"
    
    id = Column(Integer, primary_key=True)
    username = Column(String(50), unique=True, index=True)
    email = Column(String(100), unique=True, index=True)
    hashed_password = Column(String(100))
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.utcnow)

# order.py - è®¢å•æ¨¡å‹
class Order(Base):
    __tablename__ = "orders"
    
    id = Column(BigInteger, primary_key=True)
    user_id = Column(Integer, ForeignKey("users.id"))
    symbol = Column(String(32), index=True)
    side = Column(Enum(OrderSide))
    order_type = Column(Enum(OrderType))
    price = Column(Numeric(18, 4))
    quantity = Column(Integer)
    status = Column(Enum(OrderStatus))
    created_at = Column(DateTime, default=datetime.utcnow)
```

#### Pydanticæ¨¡å‹ (app/schemas/)
```python
# order.py - è®¢å•Schema
class OrderRequest(BaseModel):
    symbol: str
    side: OrderSide
    order_type: OrderType
    price: Optional[Decimal] = None
    quantity: int
    
class OrderResponse(BaseModel):
    id: str
    symbol: str
    side: OrderSide
    status: OrderStatus
    created_at: datetime
    
    class Config:
        from_attributes = True
```

### ğŸ”§ é…ç½®ç®¡ç†

#### ç¯å¢ƒé…ç½®åˆ†ç¦»
```python
# å¼€å‘ç¯å¢ƒ (.env.development)
ENV=development
DEBUG=True
DATABASE_URL=postgresql://user:pass@localhost:5432/quant_dev
REDIS_URL=redis://localhost:6379/0

# ç”Ÿäº§ç¯å¢ƒ (.env.production)
ENV=production
DEBUG=False
DATABASE_URL=postgresql://user:pass@prod-db:5432/quant_prod
REDIS_URL=redis://prod-redis:6379/0
```

#### é…ç½®ç±»è®¾è®¡
```python
class Settings(BaseSettings):
    # åŸºç¡€é…ç½®
    app_name: str = "Quant Backend"
    version: str = "1.0.0"
    debug: bool = False
    
    # æ•°æ®åº“é…ç½®
    database_url: str
    database_pool_size: int = 10
    database_max_overflow: int = 20
    
    # Redisé…ç½®
    redis_url: str
    redis_expire_time: int = 3600
    
    # CTPé…ç½®
    ctp_broker_id: str
    ctp_user_id: str
    ctp_password: str
    ctp_md_address: str
    ctp_td_address: str
    
    # JWTé…ç½®
    jwt_secret: str
    jwt_algorithm: str = "HS256"
    jwt_expire_minutes: int = 30
    
    # Celeryé…ç½®
    celery_broker_url: str
    celery_result_backend: str
    
    class Config:
        env_file = ".env"
        case_sensitive = True
```

### ğŸš€ ä»»åŠ¡é˜Ÿåˆ— (app/tasks/)

#### Celeryé…ç½®
```python
# celery_app.py
from celery import Celery

celery_app = Celery(
    "quant-backend",
    broker=settings.celery_broker_url,
    backend=settings.celery_result_backend,
    include=["app.tasks.backtest_tasks", "app.tasks.data_tasks"]
)

# ä»»åŠ¡é…ç½®
celery_app.conf.update(
    task_serializer="json",
    accept_content=["json"],
    result_serializer="json",
    timezone="Asia/Shanghai",
    enable_utc=True,
    task_routes={
        "app.tasks.backtest_tasks.*": {"queue": "backtest"},
        "app.tasks.data_tasks.*": {"queue": "data"},
    }
)
```

#### å›æµ‹ä»»åŠ¡
```python
# backtest_tasks.py
@celery_app.task(bind=True)
def run_backtest_task(self, backtest_id: str, params: dict):
    """å¼‚æ­¥å›æµ‹ä»»åŠ¡"""
    try:
        # æ›´æ–°ä»»åŠ¡çŠ¶æ€
        self.update_state(state="PROGRESS", meta={"progress": 0})
        
        # æ‰§è¡Œå›æµ‹
        backtest_service = BacktestService()
        result = backtest_service.run_backtest(params)
        
        # ç”ŸæˆæŠ¥å‘Š
        report_url = backtest_service.generate_report(result)
        
        return {
            "status": "SUCCESS",
            "result": result,
            "report_url": report_url
        }
    except Exception as exc:
        self.update_state(state="FAILURE", meta={"error": str(exc)})
        raise
```

### ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

#### æ—¥å¿—é…ç½®
```python
# app/core/logging.py
import logging
from logging.handlers import RotatingFileHandler

def setup_logging():
    """é…ç½®æ—¥å¿—ç³»ç»Ÿ"""
    
    # åˆ›å»ºæ—¥å¿—æ ¼å¼
    formatter = logging.Formatter(
        "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    )
    
    # æ–‡ä»¶å¤„ç†å™¨
    file_handler = RotatingFileHandler(
        "data/logs/app.log",
        maxBytes=10*1024*1024,  # 10MB
        backupCount=5
    )
    file_handler.setFormatter(formatter)
    file_handler.setLevel(logging.INFO)
    
    # æ§åˆ¶å°å¤„ç†å™¨
    console_handler = logging.StreamHandler()
    console_handler.setFormatter(formatter)
    console_handler.setLevel(logging.DEBUG)
    
    # æ ¹æ—¥å¿—å™¨é…ç½®
    root_logger = logging.getLogger()
    root_logger.setLevel(logging.INFO)
    root_logger.addHandler(file_handler)
    root_logger.addHandler(console_handler)
    
    # ç‰¹å®šæ¨¡å—æ—¥å¿—
    trading_logger = logging.getLogger("trading")
    trading_handler = RotatingFileHandler(
        "data/logs/trade.log",
        maxBytes=10*1024*1024,
        backupCount=10
    )
    trading_handler.setFormatter(formatter)
    trading_logger.addHandler(trading_handler)
```

#### PrometheusæŒ‡æ ‡
```python
# app/core/metrics.py
from prometheus_client import Counter, Histogram, Gauge

# è¯·æ±‚è®¡æ•°å™¨
REQUEST_COUNT = Counter(
    "http_requests_total",
    "Total HTTP requests",
    ["method", "endpoint", "status"]
)

# å“åº”æ—¶é—´ç›´æ–¹å›¾
REQUEST_DURATION = Histogram(
    "http_request_duration_seconds",
    "HTTP request duration",
    ["method", "endpoint"]
)

# æ´»è·ƒè¿æ¥æ•°
ACTIVE_CONNECTIONS = Gauge(
    "websocket_connections_active",
    "Active WebSocket connections"
)

# äº¤æ˜“æŒ‡æ ‡
ORDERS_TOTAL = Counter(
    "orders_total",
    "Total orders placed",
    ["symbol", "side", "status"]
)
```

